(()=>{"use strict";const e=["html","head","title","meta","body","script","style","path","svg","br","::marker","noscript","comment","#comment"],t=["input","img"],n={1:"element",3:"text",8:"comment"},o=["pointer-events","visibility","opacity","display","z-index","position","transform","mix-blend-mode","filter","perspective","clip-path","mask","-webkit-mask","mask-image","-webkit-mask-image","mask-border","-webkit-mask-border","isolation","will-change","-webkit-overflow-scrolling","contain","grid"],i=(e,t)=>{const n=t||e.styles;return""!==n.opacity&&"none"!==n.display&&"hidden"!==n.visibility&&"0"!==n.opacity&&"true"!==e.getAttribute("aria-hidden")},r=e=>"#text"===e.nodeName?r(e.parentNode):e;function s(e){let t="",n=r(e);const o=document.getRootNode();for(;n&&n!==o;){let e=n.localName;if(!e)break;let o=n.parentNode;if(o){let t=o.children,i=1;for(let o=0;o<t.length;o++){if(t[o]===n){e+="["+i+"]";break}t[o].localName===n.localName&&i++}}t=(n.parentNode instanceof ShadowRoot?"//":"/")+e+t,n=o.host||o}return t.toLowerCase()}const a=e=>e.children.map((e=>"option"===e.nodeName?{label:e.nodeValue,value:e.attributes.value}:"optgroup"===e.nodeName?a(e):void 0)).flat(),d=async(e,t)=>new Promise(((n,o)=>{const i=t=>{t.source===e.contentWindow&&(window.removeEventListener("message",i),n(t.data))};window.addEventListener("message",i),e.contentWindow.postMessage(t,"*"),setTimeout((()=>{o(new Error("sendMessageToIframe timed out")),window.removeEventListener({success:!1},i)}),3e3)})),l=e=>{if("#document-fragment "===e.nodeName)return null;if("#document"===e.nodeName)return null;let t=[];for(;e.parentNode;){let n=Array.from(e.parentNode.childNodes).indexOf(e)+1,o=e.nodeName.toLowerCase(),i=1===e.nodeType?o:"text()";t.unshift(i+`:nth-child(${n})`),e=e.parentNode}return t.join(" > ")},c=({element:e,id:t,rootStackingContext:n,elementStackingContexts:i})=>{if(!e||e===document)return n;e.shadowRoot;const r=e.nodeName.toLowerCase(),s=l(e.parentNode);if(!s)return n;const a=c({element:e.parentNode,id:s,rootStackingContext:n,elementStackingContexts:i});if("#text"===r&&a)return i[t]=a,a;if(void 0!==i[t])return i[t];if("html"===r)return n.nodeId=t,i[t]=n,n;const d=window.getComputedStyle(e),u=n=>(n.element=e,n.children=[],n.styles=(e=>{const t={};for(const n of o)t[n]=e.getPropertyValue(n);return t})(d),n.nodeId=t,i[t]=n,a&&(a.children.push(n),n.parentContextNode=a.nodeId),n);if(d.position&&("fixed"===d.position||"sticky"===d.position)&&"none"!==d.pointerEvents)return u({reason:`position: ${d.position}`});if(d.position&&d.zIndex&&"auto"!==d.zIndex&&"static"!==d.position&&"none"!==d.pointerEvents)return u({reason:`position: ${d.position}; z-index: ${d.zIndex}`});if(d.opacity&&"1"!==d.opacity)return u({reason:`opacity: ${d.opacity}`});if(d.transform&&"none"!==d.transform)return u({reason:`transform: ${d.transform}`});if(d.mixBlendMode&&"normal"!==d.mixBlendMode)return u({reason:`mixBlendMode: ${d.mixBlendMode}`});if(d.filter&&"none"!==d.filter)return u({reason:`filter: ${d.filter}`});if(d.perspective&&"none"!==d.perspective)return u({reason:`perspective: ${d.perspective}`});if(d.clipPath&&"none"!==d.clipPath)return u({reason:`clip-path: ${d.clipPath} `});const m=d.mask||d.webkitMask;if("none"!==m&&void 0!==m)return u({reason:`mask:  ${m}`});const p=d.maskImage||d.webkitMaskImage;if("none"!==p&&void 0!==p)return u({reason:`mask-image: ${p}`});if("isolate"===d.isolation)return u({reason:`isolation: ${d.isolation}`});if("transform"===d.willChange||"opacity"===d.willChange)return u({reason:`willChange: ${d.willChange}`});if(d.zIndex&&"auto"!==d.zIndex&&e.parentNode&&e.parentNode!==document.body){const t=window.getComputedStyle(e.parentNode);if("flex"===t.display||"inline-flex"===t.display)return u({reason:`flex-item; z-index: ${d.zIndex}`});if("none / none / none / row / auto / auto"!==t.grid)return u({reason:`child of grid container; z-index: ${d.zIndex}`})}const h=d.contain||"undefined";return["layout","paint","strict","content"].indexOf(h)>-1||h.indexOf("paint")>-1||h.indexOf("layout")>-1?u({reason:`contain: ${h}`}):(i[t]=a,a)},u=(e,t)=>{const n=((e,t)=>{const n=e=>{if("auto"!==e&&null!==e&&!Number.isNaN(+e))return+e};return e=n(e),t=n(t),e||t?!e&&!t||t&&e?e-t:(e||0)-(t||0):0})(e.styles["z-index"],t.styles["z-index"]);return 0!==n?n:e.nodeId-t.nodeId},m=e=>{if(!i(e.element,e.styles))return!1;if(e.styles.pointerEvents&&"none"===e.styles.pointerEvents)return!1;if(!e.styles||"fixed"!==e.styles.position)return!1;const t=(e=>{const t=e.getBoundingClientRect();return t?[t.x,t.y,t.height,t.width]:null})(e.element);if(!t)return!1;const[n,o,r,s]=t;return!(r*s/(window.innerHeight*window.innerWidth)<.9||n<0||o<0||n>window.innerWidth||o>window.innerHeight)},p=e=>{let t=[],n=null,o=null;e.children.sort(u);for(const i in e.children){const r=e.children[i],s=p(r);(m(r)||s)&&(n=i,o=s?s.blocker:r,t=s?s.siblings:[]),n&&i>n&&t.push(r)}return null===n?null:{blocker:o,siblings:t}},h=async(t,i="",a)=>{const c={nodeName:t.nodeName.toLowerCase(),type:n[t.nodeType],attributes:{},styles:{},children:[],data:t.nodeType===Node.TEXT_NODE?t.textContent.trim():null,nodeValue:t.nodeValue?.trim(),hasAttribute:e=>{if(t.hasAttribute)return t.hasAttribute(e)},getAttribute:e=>{if(t.getAttribute)return t.getAttribute(e)},isShadowType:!1,isBlockingAccess:!1};if(t.shadowRoot){const e=[];for(const n of t.shadowRoot.childNodes){const t=await h(n,i,a);e.push(t)}c.children=e,c.shadowDOM=!0}if(t.nodeType===Node.ELEMENT_NODE){c.attributes=((e,t)=>{const n={};for(let o=0;o<e.length;o+=1){const i=e[o],r=i.nodeName,s=i.value;!n[r]&&t.includes(r)&&(n[r]=s)}return n})(t.attributes,["type","placeholder","aria-label","title","alt","value","aria-hidden","src","srcdoc","data-src","name","id","href","data-id"]);const n=window.getComputedStyle(t);for(const e of o)c.styles[e]=n.getPropertyValue(e);c.styles["z-index"]=n.getPropertyValue("z-index"),"absolute"===n.getPropertyValue("position")&&"auto"!==c.styles["z-index"]&&"none"!==n.getPropertyValue("pointer-events")&&(c.isBlockingAccess=!0);const u=t.getBoundingClientRect();if(c.coordinates=u,c.xpath=i?i+"<<"+s(t):s(t),c.id=l(t),1!==t.childNodes.length||"#text"!==t.childNodes[0].nodeName||e.includes(t.childNodes[0].nodeName))for(const n of t.childNodes)if("IFRAME"===n.nodeName)try{const e=await d(n,{identifier:"BSTACK_EXTENTION",path:i?i+"<<"+s(n):s(n)});if(e.success){const t=JSON.parse(e.context);a.push(...t)}}catch(e){console.error("Error in snapshotDOM for iframe:",e)}else{const t=await h(n,i,a),o=r(n);t.id=l(n),t.xpath=i?i+"<<"+s(o):s(o);const d=o?.getBoundingClientRect&&o?.getBoundingClientRect();t.coordinates=d,e.includes(t.nodeName)||("text"===t.type&&t.nodeValue&&c.children.push(t),"text"!==t.type&&c.children.push(t))}else c.nodeValue=t.childNodes[0].nodeValue?.trim()}return c},f=h,g=({content:n,elementInInterest:o,rootStackingContext:r,elementStackingContexts:s,bestBlockerInfo:d})=>{n.children.forEach((n=>{const l=i(n),c=(e=>{const t=e.styles;return"a"===e.nodeName||"input"===e.nodeName||"button"===e.nodeName||"select"===e.nodeName||"textarea"===e.nodeName||e.hasAttribute("onclick")||e.hasAttribute("onmousedown")||e.hasAttribute("onmouseup")||e.hasAttribute("onkeydown")||e.hasAttribute("onkeyup")||"pointer"===t.cursor})(n),u=(({bestBlockerInfo:e,nodeId:t,elementStackingContexts:n})=>{if(!e)return!0;const o=new Set([e.blocker.nodeId,...e.siblings.map((e=>e.nodeId))]);let i=n[t];for(;i;){if(o.has(i.nodeId))return!0;i.parentContextNode,i=n[i.parentContextNode]}return!1})({bestBlockerInfo:d,nodeId:n.id,rootStackingContext:r,elementStackingContexts:s,element:n});(l||c)&&("button"===n.nodeName||"a"===n.nodeName?((e,t,n)=>{let o="";e.children.length?(e.children.forEach((t=>{t.nodeValue&&(o+=t.nodeValue,e.nodeValue=o.trim()),e.childAttributes={...t.attributes}})),n&&!e.shadowDOM&&t.push(e)):n&&!e.shadowDOM&&t.push(e)})(n,o,u):"select"===n.nodeName?(n.options=a(n),n.children=[],u&&!n.shadowDOM&&o.push(n)):n.children.length>0?((!e.includes(n.nodeName)&&n.nodeValue||t.includes(n.nodeName))&&u&&!n.shadowDOM&&o.push(n),g({content:n,elementInInterest:o,rootStackingContext:r,elementStackingContexts:s,bestBlockerInfo:d})):(!e.includes(n.nodeName)&&n.nodeValue||t.includes(n.nodeName))&&u&&!n.shadowDOM&&o.push(n))}))},N=g,x=e=>e.map(((e,t)=>{const n=e.nodeValue?.replace(/\n\s*/g," ").trim()||"",o=(e=>{let t="";return Object.entries(e).forEach((e=>{const[n,o]=e;t+=`${n}="${o}" `})),t.trim()})(e.attributes),i=((e,t)=>"a"===e?"link":"input"===e?"input":"img"===e?"img":"textarea"===e?"input":"button"===e?"button":"iframe"===e?"iframe":"select"===e?"select":"text")(e.nodeName);let r="";return"select"===i&&e.options.length&&(r=`options="${e.options.map((e=>e.value))}"`),n?`<${i} id=${t+1} ${o} ${r}>${n}</${i}>`:`<${i} id=${t+1} ${o} ${r}/>`}));window.GET_SNAPSHOT=async(e="",t=!1)=>{const n=[],o={reason:"root",children:[]},i={},r=(({rootStackingContext:e,elementStackingContexts:t})=>{const n=o=>{if(o.shadowRoot&&o.shadowRoot.childNodes.forEach((e=>{n(e)})),o.nodeType===Node.ELEMENT_NODE||o.nodeType===Node.TEXT_NODE){let i=l(o);c({element:o,id:i,rootStackingContext:e,elementStackingContexts:t});const r=o.childNodes;for(let e=0;e<r.length;e++)n(r[e])}};n(document.body);const o=p(e)||null;return console.log({bestBlockerInfo:o}),o})({rootStackingContext:o,elementStackingContexts:i}),s=document.body,a=await f(s,e,n);return N({content:a,elementInInterest:n,rootStackingContext:o,elementStackingContexts:i,bestBlockerInfo:r}),t?n:[n,x(n)]}})();